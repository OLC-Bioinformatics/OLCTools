# OLC Tools

https://lowandrew.github.io/OLCTools/bbtools/


### Program Dependencies

Testing done with: 
- BBTools 37.23 (https://jgi.doe.gov/data-and-tools/bbtools/bb-tools-user-guide/installation-guide/)
- jellyfish 2.2.6 (https://github.com/gmarcais/Jellyfish/releases)
- mash 2.0 (https://github.com/marbl/Mash/releases)
- KMC 3.0 (http://sun.aei.polsl.pl/REFRESH/index.php?page=projects&project=kmc&subpage=download)

Other versions of these programs should work, but no guarantees.

### Installation: 
`pip3 install OLCTools`

### Functionality
##### bbtools

`from biotools import bbtools`

For all bbtools, additional options can be specified with argument='parameter' passed in after mandatory arguments.

`bbtools.bbmap(reference, forward_in, out_bam)` 

Mandatory args: reference file (should be fasta 
formatted), forward reads (reverse reads will be found automatically if R1/R2 naming convention is used), output file (sam or bam).
If reverse reads do not follow naming convention, specify with reverse_in='path/to/reads'.

`bbtools.bbduk_trim(forward_in, forward_out)` 

Does quality trimming of reads.
As with bbmap, if R1/R2 naming convention is used, reverse input/output don't need to be specified.
If convenction isn't followed, specify with reverse_in='path' and reverse_out='path'

`bbtools.bbduk_bait(reference, forward_in, forward_out)` 

Baits reads in input that match reference, writes to output.
As with bbmap, if R1/R2 naming convention is used, reverse input/output don't need to be specified.
If convenction isn't followed, specify with reverse_in='path' and reverse_out='path'

`bbtools.bbduk_filter(reference, forward_in, forward_out)` 

Filters reads in input that match reference, writes clean reads to output.
As with bbmap, if R1/R2 naming convention is used, reverse input/output don't need to be specified.
If convention isn't followed, specify with reverse_in='path' and reverse_out='path'

`bbtools.dedupe(input_file, output_file)` 

Runs dedupe on input_file, writes to output_file.

`bbtools.seal(reference, forward_in, rpkm)` 

Runs seal to generate rpkm stats on reference.

`bbtools.bbnorm(forward_in, forward_out, reverse_in='NA', reverse_out='NA')`

Runs bbnorm on forward_in, writes to forward_out. 
Reverse in and out names are auto-generated
if R1/R2 naming convention followed and reverse reads are in the same folder.
If convention isn't followed, specify with reverse_in='path' and reverse_out='path'. 
Default target kmer depth is 100 - can be changed with argument target='depth'.

`bbtools.bbmerge(forward_in, merged_reads, reverse_in='NA')`

Runs bbmerge to join overlapping forward and reverse reads. As with other bbtools, reverse
reads autodetected if R1/R2 convention followed and reads are in the same folder.

`bbtools.tadpole(forward_in, forward_out, reverse_in='NA', reverse_out='NA', mode='correct')`

Runs tadpole, in read correction mode by default. Other modes can be specifed with mode='alternate_mode'.
Reverse in and out names are auto-generated
if R1/R2 naming convention followed and reverse reads are in the same folder.
If convention isn't followed, specify with reverse_in='path' and reverse_out='path'. 

`bbtools.kmercountexact(forward_in, reverse_in='NA)`

Runs kmercountexact on reads. By default, no outputs are written. To add peaks, add argument
peaks='yourpeaksfile.txt', and similarly for other arguments.

`bbtools.genome_size(peaks_file, haploid=True)`

Returns genome size, as an int, from a peaks file generated by kmercountexact. By default, looks for haploid
genome size. To get non-haploid size, set haploid=False.


##### jellyfish

`from biotools import jellyfish`

All jellyfish programs take additional options using options='string of options', where
string of options is exactly the same as what you would enter on the command line.

`jellyfish.count(forward_in, kmer_size=31, count_file='mer_counts.jf', hash_size='100M')`
 
 Runs jellyfish count, with a default kmer size of 31 and output file mer_counts.jf, finding canonical kmers.
Can be run on reads or assemblies. If using paired-end reads and following the R1/R2 naming 
 convention, reverse reads do not need to be specified. If not following convention, specify reverse reads
 with reverse_in='path/to/reverse/reads'. Handles gzipped or plain-text files (bz2 support coming soon!)

`jellyfish.dump(mer_file, outfile=counts.fasta)` 

Dumps the output file from jellyfish count (mer_file) into a human-readable
format, default file outfile.fasta.

##### mash

`from biotools import mash`

For mash, additional options are specified as argument='parameter'. If the argument is a switch with no parameter, 
pass in argument=''.

`mash.sketch(file_to_sketch_1, file_to_sketch_2, output_sketch='sketch.msh', threads=1)`

Runs mash sketch. Anything passed as a positional argument will be sketched and output to the file
specified by output_sketch. Any number of positional arguments can be called, and patterns (such as *.fastq) are also
acceptable.

`mash.dist(file_1, file_2, output_file='distances.tab', threads=1)`

Runs mash dist on positional arguments (as with `mash.sketch`, any number can be passed in and patterns work).
Outputs results to a tab-delimited file which can be interpreted by `mash.read_mash_output`

`mash.screen(sketch_file, file_1, file_2, output_file='screen.tab', threads=1)`

Runs mash screen on positional arguments. First argument must be a sketch file, followed by as many fasta/fastq files
 as you want. 

`mash.read_mash_output(result_file)`

Reads a mash output file created by mash dist. Returns a list where each entry in the list represents one row from 
the result file. Each item in the list has the following attributes: query, reference, distance, pvalue, and matching_hash.
Distance and pvalue are floats, all others are returned as strings. For example, to get the distance between the query 
and reference in a result_list for the result at index 2, use result_list[2].distance

##### fasta

`from biotools import fasta`

Operations on fasta files.

`fasta.clean_names(in_fasta, out_fasta='NA', method='split', delimiter='NA', truncate_value=10)`

Cleans up titles on fasta files in case they're too long, making programs not like them.
Only mandatory argument is in_fasta. On default settings, will split titles on whitespace, modifying the input file.
Can specify output file using out_fasta.
Can be changed to other delimiters by changing the delimiter argument. Other option is to truncate to a number
of characters, default 10. To switch to this, use the argument method='truncate'. Any other parameter for the method
argument will result in a ValueError.

##### kmc

`from biotools import kmc`

Wrappers for the kmc kmer counter. Only tested with KMC 3.0. Other paramters should be input
in argument='parameter' format. If the argument is a flag, use argument=''

`kmc.kmc(forward_in, database_name, min_occurrences=1, reverse_in='NA', k=31, cleanup=True, tmpdir='tmp')`

Runs kmc on forward reads, writes database to database_name, with a kmer size of 31. Reverse reads
automatically found if in same folder and following R1/R2 convention. Assumes fastq input - for fasta, add fm=''.

`kmc.dump(database, output, min_occurences=1, max_occurences=250)`

Dumps a database to output in tab-delimited format. No other parameters can be passed to this command.

`kmc.intersect(database_1, database_2, results)`

Finds kmers that are in both database_2 and database_1 and writes them to database in results. 
No other parameters can be passed to this command.
